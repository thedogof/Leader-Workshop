<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>國際雙語教育課程領導人工作坊｜迎賓祝福牆・暖白精品粒子版</title>
  <style>
    *{box-sizing:border-box;margin:0;padding:0;}

    /* === 整體背景：暖白＋微金，高級乾淨 === */
    body{
      height:100vh;
      padding:16px 24px;
      font-family:system-ui,-apple-system,"Noto Sans TC",sans-serif;
      background:radial-gradient(circle at top, #ffffff 0%, #fdfdfb 40%, #f8f7f2 80%);
      overflow:hidden;
      color:#d9a953;          /* 柔亮香檳金 */
      display:flex;
      flex-direction:column;
    }

    header{
      text-align:center;
      z-index:2;
      position:relative;
      flex:0 0 auto;
    }

    h1{
      font-size:2rem;
      font-weight:700;
      color:#d9a953;
      letter-spacing:0.04em;
      text-shadow:
        0 0 14px rgba(255,249,221,.95),
        0 0 32px rgba(255,235,180,.55);
    }

    main{
      flex:1 1 auto;
      margin-top:8px;
      border-radius:24px;
      background:linear-gradient(
        to bottom right,
        rgba(255,255,255,.97),
        rgba(252,249,236,.92)
      );
      position:relative;
      overflow:hidden;
      padding:16px;
      box-shadow:
        0 12px 40px rgba(200,180,120,.25),
        0 0 0 1px rgba(245,235,200,.6);
    }

    /* === 背景動態光雲（暖白金光呼吸） === */
    .halo{
      position:absolute;
      border-radius:999px;
      filter:blur(60px);
      mix-blend-mode:screen;
      animation:haloGlow 14s ease-in-out infinite;
      opacity:.85;
      pointer-events:none;
      z-index:0;
    }

    @keyframes haloGlow {
      0%   { opacity:.55; transform:scale(0.92); }
      25%  { opacity:.9;  transform:scale(1.05); }
      50%  { opacity:.68; transform:scale(0.98); }
      75%  { opacity:.95; transform:scale(1.08); }
      100% { opacity:.55; transform:scale(0.90); }
    }

    .halo.h1{
      width:480px; height:480px;
      top:-160px; left:50%; transform:translateX(-50%);
      background:radial-gradient(circle, #fff8db 0%, rgba(255,255,255,0) 70%);
      animation-delay:0s;
    }
    .halo.h2{
      width:380px; height:380px;
      bottom:-140px; left:-80px;
      background:radial-gradient(circle, #fff2ce 0%, rgba(255,255,255,0) 70%);
      animation-delay:2s;
    }
    .halo.h3{
      width:380px; height:380px;
      bottom:-160px; right:-60px;
      background:radial-gradient(circle, #ffeebe 0%, rgba(255,255,255,0) 70%);
      animation-delay:1s;
    }

    /* === 金粉粒子層 === */
    .particle-layer{
      position:absolute;
      inset:0;
      pointer-events:none;
      z-index:1;
      overflow:hidden;
    }

    .particle{
      position:absolute;
      width:6px;
      height:6px;
      border-radius:999px;
      background:radial-gradient(circle, #ffe8b6 0%, rgba(255,232,182,0) 70%);
      opacity:0;
      filter:blur(0.3px);
      mix-blend-mode:screen;
      animation:particleFloat linear infinite;
    }

    @keyframes particleFloat{
      0%{
        transform:translate3d(0,0,0) scale(0.7);
        opacity:0;
      }
      10%{
        opacity:.7;
      }
      50%{
        transform:translate3d(12px,-40px,0) scale(1);
        opacity:1;
      }
      90%{
        opacity:.4;
      }
      100%{
        transform:translate3d(-8px,-80px,0) scale(0.6);
        opacity:0;
      }
    }

    /* === 祝福浮動層 === */
    .blessing-layer{
      position:absolute;
      inset:0;
      overflow:hidden;
      z-index:3;
      pointer-events:none;
    }

    #placeholder{
      position:absolute;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:1.4rem;
      color:#dcb67a;
      text-shadow:0 0 12px rgba(255,245,215,.9);
      z-index:2;
      text-align:center;
      padding:0 40px;
    }

    /* === 浮動祝福卡片：暖白玻璃＋香檳金字 === */
    .floating-blessing{
      position:absolute;
      max-width:50vw;
      min-width:260px;
      padding:14px 20px;
      border-radius:22px;
      background:linear-gradient(
        135deg,
        rgba(255,255,255,.98),
        rgba(254,252,238,.96)
      );
      border:1px solid rgba(255,234,180,.9);
      color:#d9a953;  /* 主體字：香檳金 */
      font-size:1.38rem;
      line-height:1.6;

      text-shadow:
        0 0 4px rgba(255,255,255,1),
        0 0 14px rgba(255,240,200,.8),
        0 0 24px rgba(255,230,150,.6);

      box-shadow:
        0 0 40px rgba(255,240,200,.95),
        0 0 85px rgba(255,252,238,.95),
        0 16px 45px rgba(215,180,105,.35);

      backdrop-filter:blur(18px);
      -webkit-backdrop-filter:blur(18px);

      opacity:0;
      transform:translate(-50%,0);
      animation:floatUp 30s ease-in-out forwards;
    }

    .floating-blessing .quote{
      display:block;
      margin-bottom:8px;
      font-weight:600;
      letter-spacing:0.02em;
      color:#e5b86a; /* 主句：更亮的奶金 */
    }

    .floating-blessing .quote::before{content:"「";}
    .floating-blessing .quote::after{content:"」";}

    .floating-blessing .meta{
      margin-top:4px;
      font-size:1rem;
      color:#dcb67a; /* 名稱／單位：柔金 */
    }
    .floating-blessing .meta span+span::before{
      content:"／";
      margin:0 .25rem;
      color:#eac57d;
    }

    /* 漂浮動畫：往上、高一點＋柔和呼吸 */
    @keyframes floatUp {
      0%   { opacity:0;  transform:translate(-50%, 32px) scale(0.96); }
      10%  { opacity:.96;transform:translate(-50%, 8px)  scale(1); }
      30%  { opacity:1;  transform:translate(calc(-50% + 8px), -8px)  scale(1.01); }
      46%  { opacity:.85;transform:translate(calc(-50% - 6px), -36px) scale(1.015); }
      60%  { opacity:1;  transform:translate(calc(-50% + 4px), -72px) scale(1.02); }
      80%  { opacity:.88;transform:translate(calc(-50% - 3px), -116px)scale(1.03); }
      92%  { opacity:.94;transform:translate(calc(-50% + 2px), -150px)scale(1.04); }
      100% { opacity:0;  transform:translate(-50%, -190px)         scale(1.06); }
    }

    @media(max-width:768px){
      .floating-blessing{
        max-width:72vw;
        font-size:1.18rem;
      }
    }
  </style>
</head>

<body>

<header>
  <h1>國際雙語教育課程領導人工作坊｜迎賓祝福牆</h1>
</header>

<main>
  <!-- 背景光雲 -->
  <div class="halo h1"></div>
  <div class="halo h2"></div>
  <div class="halo h3"></div>

  <!-- 金粉粒子層 -->
  <div class="particle-layer" id="particle-layer"></div>

  <div id="placeholder">
    目前尚無祝福訊息，請貴賓於簽到頁面留下「迎賓祝福小語」，畫面將自動更新。
  </div>

  <div class="blessing-layer" id="blessing-layer"></div>
</main>

<script>
  const ENDPOINT="https://script.google.com/macros/s/AKfycbx3Ctad6gL8PTq37VhO9kIC80SwTKVlYymODj0DJWl9-v7fYCU_9mLcbhN4qWGV2zhkCw/exec";
  const layer=document.getElementById('blessing-layer');
  const placeholder=document.getElementById('placeholder');
  const particleLayer=document.getElementById('particle-layer');

  let blessingsData=[];
  let blessingIndex=0;
  const MAX_VISIBLE=12;
  const OVERLAP_PADDING=18;

  function escapeHtml(str){
    return (str||'').replace(/[&<>"]/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c]));
  }

  function setPlaceholderVisible(s){ placeholder.style.display=s?'flex':'none'; }

  function isOverlapping(rect,others){
    return others.some(o =>
      rect.right > o.left - OVERLAP_PADDING &&
      rect.left  < o.right + OVERLAP_PADDING &&
      rect.bottom> o.top - OVERLAP_PADDING &&
      rect.top   < o.bottom + OVERLAP_PADDING
    );
  }

  function spawnBlessing(){
    if(!blessingsData.length) return;

    const existing=Array.from(layer.querySelectorAll('.floating-blessing'));
    if(existing.length>=MAX_VISIBLE) return;

    const b = blessingsData[ blessingIndex % blessingsData.length ];
    blessingIndex++;

    const div=document.createElement('div');
    div.className='floating-blessing';
    div.style.visibility='hidden';

    div.innerHTML=
      '<span class="quote">'+escapeHtml(b.blessing)+'</span>'+
      '<div class="meta">'+
        '<span>'+escapeHtml(b.name||'')+'</span>'+
        '<span>'+escapeHtml(b.unit||'')+'</span>'+
        '<span>'+escapeHtml(b.title||'')+'</span>'+
      '</div>';

    layer.appendChild(div);

    const rects=existing.map(el=>el.getBoundingClientRect());
    let placed=false, tries=0;

    while(tries<12 && !placed){
      const left =15+Math.random()*70;  // 15% ~ 85%
      const top  =18+Math.random()*60; // 18% ~ 78%
      div.style.left=left+'%';
      div.style.top =top+'%';

      const r=div.getBoundingClientRect();
      if(!isOverlapping(r,rects)) placed=true;
      else tries++;
    }

    const duration=26+Math.random()*16;  // 26~42 秒
    div.style.animationDuration=duration+'s';
    div.style.visibility='visible';

    setTimeout(()=>div.remove(), (duration+1)*1000);
  }

  function renderBlessings(items){
    blessingsData=items||[];
    blessingIndex=0;

    if(!blessingsData.length){
      setPlaceholderVisible(true);
    }else{
      setPlaceholderVisible(false);

      if(layer.querySelectorAll('.floating-blessing').length<3){
        const initial=Math.min(6,blessingsData.length);
        for(let i=0;i<initial;i++){
          setTimeout(spawnBlessing,i*800);
        }
      }
    }
  }

  function loadBlessings(){
    const cb='cb_'+Date.now();
    const s=document.createElement('script');
    s.src=ENDPOINT+'?mode=listBlessings&callback='+cb;

    window[cb]=data=>{
      if(data && data.ok) renderBlessings(data.items||[]);
      delete window[cb];
      s.remove();
    };
    document.body.appendChild(s);
  }

  // 定期產生新的浮動祝福（錯落出現）
  setInterval(spawnBlessing,2400);
  loadBlessings();
  setInterval(loadBlessings,10000);

  // === 產生金粉粒子 ===
  function initParticles(){
    if(!particleLayer) return;
    const COUNT = 38; // 顆數

    for(let i=0;i<COUNT;i++){
      const p=document.createElement('div');
      p.className='particle';
      const size = 3 + Math.random()*5; // 3~8px
      p.style.width = size+'px';
      p.style.height = size+'px';

      const left = Math.random()*100;
      const top  = Math.random()*100;

      p.style.left = left+'%';
      p.style.top  = top+'%';

      const dur = 16 + Math.random()*18;      // 16~34s
      const delay = -Math.random()*dur;       // 負 delay 讓粒子一開始就分散
      p.style.animationDuration = dur+'s';
      p.style.animationDelay    = delay+'s';

      particleLayer.appendChild(p);
    }
  }

  initParticles();
</script>
</body>
</html>
