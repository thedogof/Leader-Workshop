<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>國際雙語教育課程領導人工作坊｜迎賓祝福牆・紙纖維灰金版 C7</title>
  <style>
    *{box-sizing:border-box;margin:0;padding:0;}

    /* === 整體背景：紙纖維肌理 × 灰金 === */
    body{
      height:100vh;
      padding:16px 24px;
      font-family:system-ui,-apple-system,"Noto Sans TC",sans-serif;
      /* 底色：溫和偏冷的象牙白 */
      background-color:#f4f3ef;
      /* 紙纖維感：細線＋大面積淡雜訊疊加 */
      background-image:
        /* 細橫纖維 */
        repeating-linear-gradient(
          180deg,
          rgba(200,195,185,0.16) 0px,
          rgba(200,195,185,0.16) 1px,
          rgba(244,243,239,0) 2px,
          rgba(244,243,239,0) 4px
        ),
        /* 大塊紙紋陰影 */
        linear-gradient(
          135deg,
          rgba(255,255,255,0.9),
          rgba(235,231,223,0.95)
        );
      overflow:hidden;
      color:#8c7a5a;          /* 柔和灰金 */
      display:flex;
      flex-direction:column;
    }

    header{
      text-align:center;
      z-index:2;
      position:relative;
      flex:0 0 auto;
    }

    h1{
      font-size:2rem;
      font-weight:600;
      color:#8c7a5a;          /* 灰金標題 */
      letter-spacing:0.18em;
      text-shadow:
        0 0 2px rgba(255,255,255,.9);
    }

    main{
      flex:1 1 auto;
      margin-top:10px;
      border-radius:26px;
      background:
        linear-gradient(
          135deg,
          rgba(255,255,255,.98),
          rgba(248,247,243,.96)
        );
      position:relative;
      overflow:hidden;
      padding:18px;
      box-shadow:
        0 16px 42px rgba(150,140,120,.22),
        0 0 0 1px rgba(220,215,204,.9);
    }

    /* === 背景光雲：更克制，偏冷灰金 === */
    .halo{
      position:absolute;
      border-radius:999px;
      filter:blur(46px);
      mix-blend-mode:screen;
      animation:haloGlow 20s ease-in-out infinite;
      opacity:.40;
      pointer-events:none;
      z-index:0;
    }

    @keyframes haloGlow {
      0%   { opacity:.32; transform:scale(0.95); }
      25%  { opacity:.6;  transform:scale(1.02); }
      50%  { opacity:.38; transform:scale(0.98); }
      75%  { opacity:.65; transform:scale(1.04); }
      100% { opacity:.32; transform:scale(0.95); }
    }

    .halo.h1{
      width:340px; height:340px;
      top:-120px; left:50%; transform:translateX(-50%);
      background:radial-gradient(circle, #f7f1dc 0%, rgba(255,255,255,0) 72%);
    }
    .halo.h2{
      width:260px; height:260px;
      bottom:-110px; left:-40px;
      background:radial-gradient(circle, #ece3cf 0%, rgba(255,255,255,0) 70%);
      animation-delay:2.5s;
    }
    .halo.h3{
      width:260px; height:260px;
      bottom:-120px; right:-40px;
      background:radial-gradient(circle, #e8e0d0 0%, rgba(255,255,255,0) 70%);
      animation-delay:1.2s;
    }

    /* === 紙屑／粉塵型粒子層（偏灰金，低調） === */
    .particle-layer{
      position:absolute;
      inset:0;
      pointer-events:none;
      z-index:1;
      overflow:hidden;
    }

    .particle{
      position:absolute;
      border-radius:999px;
      background:radial-gradient(circle, #d7c8ac 0%, rgba(215,200,172,0) 72%);
      opacity:0;
      mix-blend-mode:screen;
      animation:particleFloat linear infinite;
      filter:blur(0.5px);
    }

    @keyframes particleFloat{
      0%{
        transform:translate3d(0,0,0) scale(0.7);
        opacity:0;
      }
      15%{
        opacity:.32;
      }
      55%{
        transform:translate3d(10px,-60px,0) scale(0.9);
        opacity:.8;
      }
      90%{
        opacity:.18;
      }
      100%{
        transform:translate3d(-8px,-120px,0) scale(0.7);
        opacity:0;
      }
    }

    /* === 祝福浮動層 === */
    .blessing-layer{
      position:absolute;
      inset:0;
      overflow:hidden;
      z-index:3;
      pointer-events:none;
    }

    #placeholder{
      position:absolute;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:1.3rem;
      color:#9b8764;
      text-shadow:0 0 4px rgba(255,252,242,.9);
      z-index:2;
      text-align:center;
      padding:0 40px;
    }

    /* === 浮動祝福卡片：像高級信紙壓紋 === */
    .floating-blessing{
      position:absolute;
      max-width:50vw;
      min-width:260px;
      padding:14px 22px;
      border-radius:22px;
      background:
        linear-gradient(
          145deg,
          rgba(255,255,255,.98),
          rgba(247,246,241,.96)
        );
      border:1px solid rgba(214,206,192,.95);
      color:#6e5d45;          /* 文字偏咖啡墨色 */
      font-size:1.32rem;
      line-height:1.6;

      text-shadow:
        0 0 1px rgba(255,255,255,0.9);

      box-shadow:
        0 6px 20px rgba(150,140,125,.26),
        0 0 0 1px rgba(237,233,224,.9);

      backdrop-filter:blur(10px);
      -webkit-backdrop-filter:blur(10px);

      opacity:0;
      transform:translate(-50%,0);
      animation:floatUp 30s ease-in-out forwards;
    }

    .floating-blessing .quote{
      display:block;
      margin-bottom:8px;
      font-weight:600;
      letter-spacing:0.04em;
      color:#8c7448;          /* 灰金標語文字 */
    }

    .floating-blessing .quote::before{content:"「";}
    .floating-blessing .quote::after{content:"」";}

    .floating-blessing .meta{
      margin-top:6px;
      font-size:0.96rem;
      color:#a1906c;
    }
    .floating-blessing .meta span+span::before{
      content:"／";
      margin:0 .25rem;
      color:#b9a57c;
    }

    /* 漂浮動畫（沿用原本節奏） */
    @keyframes floatUp {
      0%   { opacity:0;  transform:translate(-50%, 28px) scale(0.97); }
      10%  { opacity:.96;transform:translate(-50%, 6px)  scale(1); }
      30%  { opacity:1;  transform:translate(calc(-50% + 8px), -6px)  scale(1.01); }
      46%  { opacity:.9; transform:translate(calc(-50% - 6px), -32px) scale(1.01); }
      60%  { opacity:1;  transform:translate(calc(-50% + 4px), -66px) scale(1.02); }
      80%  { opacity:.9; transform:translate(calc(-50% - 3px), -108px)scale(1.025); }
      92%  { opacity:.95;transform:translate(calc(-50% + 2px), -140px)scale(1.035); }
      100% { opacity:0;  transform:translate(-50%, -180px)         scale(1.05); }
    }

    @media(max-width:768px){
      .floating-blessing{
        max-width:72vw;
        font-size:1.16rem;
      }
    }
  </style>
</head>

<body>

<header>
  <h1>國際雙語教育課程領導人工作坊｜迎賓祝福牆</h1>
</header>

<main>
  <!-- 背景光雲 -->
  <div class="halo h1"></div>
  <div class="halo h2"></div>
  <div class="halo h3"></div>

  <!-- 紙屑粉塵粒子層 -->
  <div class="particle-layer" id="particle-layer"></div>

  <div id="placeholder">
    目前尚無祝福訊息，請貴賓於簽到頁面留下「迎賓祝福小語」，畫面將自動更新。
  </div>

  <div class="blessing-layer" id="blessing-layer"></div>
</main>

<script>
  const ENDPOINT="https://script.google.com/macros/s/AKfycbx3Ctad6gL8PTq37VhO9kIC80SwTKVlYymODj0DJWl9-v7fYCU_9mLcbhN4qWGV2zhkCw/exec";
  const layer=document.getElementById('blessing-layer');
  const placeholder=document.getElementById('placeholder');
  const particleLayer=document.getElementById('particle-layer');

  let blessingsData=[];
  let blessingIndex=0;
  const MAX_VISIBLE=12;
  const OVERLAP_PADDING=18;

  function escapeHtml(str){
    return (str||'').replace(/[&<>"]/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c]));
  }

  function setPlaceholderVisible(s){ placeholder.style.display=s?'flex':'none'; }

  function isOverlapping(rect,others){
    return others.some(o =>
      rect.right > o.left - OVERLAP_PADDING &&
      rect.left  < o.right + OVERLAP_PADDING &&
      rect.bottom> o.top - OVERLAP_PADDING &&
      rect.top   < o.bottom + OVERLAP_PADDING
    );
  }

  function spawnBlessing(){
    if(!blessingsData.length) return;

    const existing=Array.from(layer.querySelectorAll('.floating-blessing'));
    if(existing.length>=MAX_VISIBLE) return;

    const b = blessingsData[ blessingIndex % blessingsData.length ];
    blessingIndex++;

    const div=document.createElement('div');
    div.className='floating-blessing';
    div.style.visibility='hidden';

    div.innerHTML=
      '<span class="quote">'+escapeHtml(b.blessing)+'</span>'+
      '<div class="meta">'+
        '<span>'+escapeHtml(b.name||'')+'</span>'+
        '<span>'+escapeHtml(b.unit||'')+'</span>'+
        '<span>'+escapeHtml(b.title||'')+'</span>'+
      '</div>';

    layer.appendChild(div);

    const rects=existing.map(el=>el.getBoundingClientRect());
    let placed=false, tries=0;

    while(tries<12 && !placed){
      const left =15+Math.random()*70;  // 15% ~ 85%
      const top  =18+Math.random()*60; // 18% ~ 78%
      div.style.left=left+'%';
      div.style.top =top+'%';

      const r=div.getBoundingClientRect();
      if(!isOverlapping(r,rects)) placed=true;
      else tries++;
    }

    const duration=24+Math.random()*14;  // 24~38 秒
    div.style.animationDuration=duration+'s';
    div.style.visibility='visible';

    setTimeout(()=>div.remove(), (duration+1)*1000);
  }

  function renderBlessings(items){
    blessingsData=items||[];
    blessingIndex=0;

    if(!blessingsData.length){
      setPlaceholderVisible(true);
    }else{
      setPlaceholderVisible(false);

      if(layer.querySelectorAll('.floating-blessing').length<3){
        const initial=Math.min(6,blessingsData.length);
        for(let i=0;i<initial;i++){
          setTimeout(spawnBlessing,i*800);
        }
      }
    }
  }

  function loadBlessings(){
    const cb='cb_'+Date.now();
    const s=document.createElement('script');
    s.src=ENDPOINT+'?mode=listBlessings&callback='+cb;

    window[cb]=data=>{
      if(data && data.ok) renderBlessings(data.items||[]);
      delete window[cb];
      s.remove();
    };
    document.body.appendChild(s);
  }

  // 定期產生新的浮動祝福（錯落出現）
  setInterval(spawnBlessing,2400);
  loadBlessings();
  setInterval(loadBlessings,10000);

  // === 產生紙塵感粒子 ===
  function initParticles(){
    if(!particleLayer) return;

    const COUNT = 420; // 顆數，紙屑感但不炸裂

    for(let i=0;i<COUNT;i++){
      const p = document.createElement('div');
      p.className = 'particle';

      const size = 1.4 + Math.random()*1.1;  // 約 1.4~2.5px
      p.style.width = size + 'px';
      p.style.height = size + 'px';

      p.style.left = Math.random()*100 + '%';
      p.style.top  = Math.random()*100 + '%';

      const dur   = 22 + Math.random()*24; // 22~46 秒
      const delay = -Math.random()*dur;
      p.style.animationDuration = dur + 's';
      p.style.animationDelay    = delay + 's';

      particleLayer.appendChild(p);
    }
  }

  initParticles();
</script>
</body>
</html>
