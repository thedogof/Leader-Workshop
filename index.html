<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>國際雙語教育課程領導人工作坊｜線上簽到</title>
  <style>
    :root { --bg1:#eef2ff; --bg2:#ffffff; --ink:#1f2933; --muted:#6b7280; --accent:#2563eb; }
    *{box-sizing:border-box}
    html,body{
      margin:0;
      padding:0;
      height:100%;
    }
    body{
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Noto Sans TC",sans-serif;
      background:radial-gradient(circle at top,#e0f2fe 0,#f9fafb 40%,#ffffff 100%);
      color:var(--ink);
      position:relative;
      overflow:hidden;
    }

    /* ===== 背景祝福牆 ===== */
    .bless-bg{
      position:fixed;
      inset:0;
      overflow:hidden;
      z-index:0;
      pointer-events:none;
      opacity:0.12; /* 整體淡一點，避免干擾閱讀 */
    }
    .bg-gradient{
      position:absolute;
      inset:0;
      background:
        radial-gradient(circle at top left,rgba(59,130,246,.35) 0,transparent 55%),
        radial-gradient(circle at bottom right,rgba(251,191,36,.35) 0,transparent 55%);
      mix-blend-mode:screen;
      opacity:.8;
    }
    .bg-row{
      position:absolute;
      left:0;
      right:0;
      height:20%;
      display:flex;
      align-items:center;
      white-space:nowrap;
      overflow:hidden;
    }
    .bg-row:nth-child(1){ top:10%; }
    .bg-row:nth-child(2){ top:35%; }
    .bg-row:nth-child(3){ top:60%; }
    .bg-row:nth-child(4){ top:85%; }

    .bg-marquee{
      display:inline-block;
      padding-left:100%;
      animation:bg-marquee 70s linear infinite;
    }
    .bg-row:hover .bg-marquee{
      animation-play-state:paused;
    }
    @keyframes bg-marquee{
      0%{transform:translateX(0)}
      100%{transform:translateX(-100%)}
    }
    .bg-item{
      display:inline-flex;
      align-items:baseline;
      margin:0 3rem;
      font-size:1.4rem;
      color:#fbbf24;
      text-shadow:0 0 10px rgba(0,0,0,.25);
    }
    .bg-item .name{
      color:#111827;
      font-size:1rem;
      margin-left:.75rem;
      white-space:nowrap;
    }
    .bg-item .details{
      color:#e5e7eb;
      font-size:.85rem;
      margin-left:.5rem;
      white-space:nowrap;
    }

    /* ===== 前景簽到卡片 ===== */
    .wrap{
      position:relative;
      z-index:10;
      max-width:760px;
      margin:3.5rem auto;
      padding:0 24px;
    }
    .card{
      background:rgba(255,255,255,.9);
      backdrop-filter:blur(14px);
      border-radius:20px;
      box-shadow:
        0 20px 40px rgba(15,23,42,.18),
        0 0 0 1px rgba(148,163,184,.3);
      padding:28px 26px 24px;
    }
    h1{
      font-size:1.45rem;
      margin:0 0 4px;
      letter-spacing:.03em;
    }
    .sub{
      color:var(--muted);
      font-size:.95rem;
      margin:0 0 18px;
    }
    label{display:block;font-weight:600;margin:.75rem 0 .4rem}
    input, textarea{
      width:100%;
      padding:12px 14px;
      border:1px solid #e2e8f0;
      border-radius:12px;
      font-size:1rem;
      background:#f9fafb;
    }
    input:focus, textarea:focus{
      outline:2px solid rgba(37,99,235,.25);
      border-color:var(--accent);
      background:#ffffff;
    }
    textarea{
      resize:vertical;
      min-height:70px;
      max-height:160px;
    }
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    button{
      padding:12px 16px;
      border:0;
      border-radius:999px;
      background:var(--accent);
      color:#fff;
      font-weight:700;
      font-size:1rem;
      cursor:pointer;
      box-shadow:0 10px 20px rgba(37,99,235,.35);
      transition:transform .12s ease,box-shadow .12s ease,opacity .12s ease;
    }
    button:hover{
      transform:translateY(-1px);
      box-shadow:0 14px 26px rgba(37,99,235,.4);
    }
    button:active{
      transform:translateY(0);
      box-shadow:0 8px 14px rgba(37,99,235,.3);
    }
    .btn-full{width:100%;margin-top:18px}
    .note{font-size:.9rem;color:var(--muted);margin-top:10px}
    .footer{
      margin-top:18px;
      color:var(--muted);
      font-size:.82rem;
      text-align:center;
    }
    a.link{color:var(--accent);text-decoration:none}

    .bless-box{
      margin-top:24px;
      padding-top:18px;
      border-top:1px dashed #e2e8f0;
    }
    .bless-header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:8px;
      flex-wrap:wrap;
    }
    .bless-hint{
      font-size:.8rem;
      color:var(--muted);
      margin-top:6px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:8px;
      flex-wrap:wrap;
    }
    .count{
      font-variant-numeric:tabular-nums;
    }
    .pill-btn{
      background:#e5e7eb;
      color:#374151;
      font-size:.8rem;
      padding:6px 10px;
      border-radius:999px;
      box-shadow:none;
    }
    .pill-btn:hover{
      transform:none;
      box-shadow:none;
      background:#d1d5db;
    }

    @media (max-width:640px){
      .wrap{margin:2.5rem auto}
      .card{padding:22px 18px 18px}
      h1{font-size:1.25rem}
    }
  </style>
</head>
<body>

  <!-- ==== 背景祝福跑馬燈 ==== -->
  <div class="bless-bg">
    <div class="bg-gradient"></div>
    <div class="bg-row"><div class="bg-marquee" id="bg1"></div></div>
    <div class="bg-row"><div class="bg-marquee" id="bg2"></div></div>
    <div class="bg-row"><div class="bg-marquee" id="bg3"></div></div>
    <div class="bg-row"><div class="bg-marquee" id="bg4"></div></div>
  </div>

  <!-- ==== 前景簽到卡 ==== -->
  <div class="wrap">
    <div class="card">
      <h1>國際雙語教育課程領導人工作坊</h1>
      <p class="sub">線上簽到（請填寫：單位／職稱／姓名，可加上一句迎賓祝福小語）</p>

      <form
        method="POST"
        action="https://script.google.com/macros/s/AKfycbx3Ctad6gL8PTq37VhO9kIC80SwTKVlYymODj0DJWl9-v7fYCU_9mLcbhN4qWGV2zhkCw/exec"
      >
        <label for="unit">單位（例：大園國小）</label>
        <input id="unit" name="unit" required maxlength="40" placeholder="請輸入單位" />

        <div class="row">
          <div>
            <label for="title">職稱（例：校長）</label>
            <input id="title" name="title" required maxlength="20" placeholder="請輸入職稱" />
          </div>
          <div>
            <label for="name">姓名（例：王ＯＯ）</label>
            <input id="name" name="name" required maxlength="20" placeholder="請輸入姓名" />
          </div>
        </div>

        <div class="bless-box">
          <div class="bless-header">
            <label for="blessing">迎賓祝福小語（非必填）</label>
            <button type="button" id="blessRandomBtn" class="pill-btn">
              沒靈感？幫我想一句
            </button>
          </div>
          <textarea id="blessing" name="blessing" maxlength="50"
            placeholder="例：祝工作坊圓滿順利，讓孩子的世界因雙語而更寬廣。"></textarea>
          <div class="bless-hint">
            <span>最多 50 字，將同步出現在祝福牆與此頁背景。</span>
            <span class="count" id="blessCount">0 / 50</span>
          </div>
        </div>

        <button type="submit" class="btn-full">送出簽到</button>
        <p class="note">送出後系統會記錄簽到時間與 IP，祝福內容則用於現場祝福牆與背景展示。</p>
      </form>

      <div class="footer">
        © 桃園市國際雙語教育課程領導人工作坊 ｜ 
        <a class="link" href="blessing.html" target="_blank">開啟全螢幕迎賓祝福牆</a>
      </div>
    </div>
  </div>

  <script>
    // ===== 祝福輸入：隨機小語 + 字數計數 =====
    const blessInput = document.getElementById('blessing');
    const blessBtn   = document.getElementById('blessRandomBtn');
    const blessCount = document.getElementById('blessCount');

    const presets = [
      "祝工作坊圓滿順利、收穫滿滿！",
      "願雙語教學讓孩子看見更大的世界。",
      "謝謝各位領導人為孩子多走一步。",
      "祝大家今天都被好的靈感擊中。",
      "願每一次課堂，都是孩子的世界探險。"
    ];

    function updateCount(){
      blessCount.textContent = blessInput.value.length + " / 50";
    }
    blessInput.addEventListener('input', updateCount);
    updateCount();

    blessBtn.addEventListener('click', () => {
      const t = presets[Math.floor(Math.random()*presets.length)];
      blessInput.value = t;
      updateCount();
    });

    // ===== 背景祝福牆：跟 blessing.html 同一個後端 =====
    const ENDPOINT = "https://script.google.com/macros/s/AKfycbx3Ctad6gL8PTq37VhO9kIC80SwTKVlYymODj0DJWl9-v7fYCU_9mLcbhN4qWGV2zhkCw/exec";

    const bgEls = [
      document.getElementById('bg1'),
      document.getElementById('bg2'),
      document.getElementById('bg3'),
      document.getElementById('bg4'),
    ];

    function escapeHtml(str){
      return (str || '').replace(/[&<>"]/g, c => ({
        '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'
      }[c] || c));
    }

    function renderBackground(items){
      if (!items || items.length === 0){
        bgEls.forEach(el => el.innerHTML = '');
        return;
      }
      const cols = [[],[],[],[]];
      items.forEach((b,i) => {
        cols[i % 4].push(b);
      });

      cols.forEach((col, idx) => {
        const el = bgEls[idx];
        el.innerHTML = '';
        col.forEach(b => {
          const span = document.createElement('span');
          span.className = 'bg-item';
          span.innerHTML =
            '「' + escapeHtml(b.blessing) + '」' +
            '<span class="name">' + escapeHtml(b.name) + '</span>' +
            '<span class="details">' +
              escapeHtml(b.unit) + '／' + escapeHtml(b.title) +
            '</span>';
          el.appendChild(span);
        });
      });
    }

    function loadBlessingsForBg(){
      const cbName = 'bgBless_cb_' + Date.now() + '_' + Math.floor(Math.random()*9999);
      const script = document.createElement('script');
      script.src = ENDPOINT + '?mode=listBlessings&callback=' + cbName;

      window[cbName] = function(data){
        try{
          if (data && data.ok){
            renderBackground(data.items || []);
          }
        }finally{
          delete window[cbName];
          script.remove();
        }
      };

      script.onerror = function(){
        delete window[cbName];
        script.remove();
      };

      document.body.appendChild(script);
    }

    loadBlessingsForBg();
    setInterval(loadBlessingsForBg, 5000);
  </script>
</body>
</html>
